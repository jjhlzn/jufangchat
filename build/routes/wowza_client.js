var digestRequest = require('request-digest')('jufang', 'jufang2016');
var parseString = require('xml2js').parseString;
module.exports.get_client_count = function (streamName, func) {
    digestRequest.request({
        host: 'http://114.55.147.70',
        path: '/connectioncounts?flat',
        port: 8086,
        method: 'GET',
    }, function (error, response, body) {
        if (error) {
            func('0');
            //throw error;
            return;
        }
        //console.log(body);
        parseString(body, function (err, result) {
            //console.dir(result);
            var streams = result['WowzaStreamingEngine']['Stream'];
            //console.log('streams = ' + streams);
            for (var i = 0; i < streams.length; i++) {
                //console.log(streams[i]);
                var stream = streams[i]['$'];
                var name = stream['streamName'];
                var sessionsTotal = stream['sessionsTotal'];
                if (name == streamName) {
                    if (func) {
                        func(sessionsTotal);
                        return;
                    }
                }
            }
            func('0');
        });
    });
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3JvdXRlcy93b3d6YV9jbGllbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsSUFBSSxhQUFhLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBQ3RFLElBQUksV0FBVyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxXQUFXLENBQUM7QUFFaEQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsR0FBRyxVQUFTLFVBQVUsRUFBRSxJQUFJO0lBQ3ZELGFBQWEsQ0FBQyxPQUFPLENBQUM7UUFDbEIsSUFBSSxFQUFFLHNCQUFzQjtRQUM1QixJQUFJLEVBQUUsd0JBQXdCO1FBQzlCLElBQUksRUFBRSxJQUFJO1FBQ1YsTUFBTSxFQUFFLEtBQUs7S0FDaEIsRUFBRSxVQUFVLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSTtRQUM5QixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ1YsY0FBYztZQUNkLE1BQU0sQ0FBQztRQUNYLENBQUM7UUFFRCxvQkFBb0I7UUFDcEIsV0FBVyxDQUFDLElBQUksRUFBRSxVQUFVLEdBQUcsRUFBRSxNQUFNO1lBQ25DLHNCQUFzQjtZQUN0QixJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN2RCxzQ0FBc0M7WUFDdEMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ3RDLDBCQUEwQjtnQkFDMUIsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUM3QixJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQ2hDLElBQUksYUFBYSxHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQztnQkFFNUMsRUFBRSxDQUFDLENBQUMsSUFBSSxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUM7b0JBQ3JCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7d0JBQ1AsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO3dCQUNwQixNQUFNLENBQUM7b0JBQ1gsQ0FBQztnQkFDTCxDQUFDO1lBQ0wsQ0FBQztZQUVELElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNkLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUEiLCJmaWxlIjoicm91dGVzL3dvd3phX2NsaWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuXG52YXIgZGlnZXN0UmVxdWVzdCA9IHJlcXVpcmUoJ3JlcXVlc3QtZGlnZXN0JykoJ2p1ZmFuZycsICdqdWZhbmcyMDE2Jyk7XG52YXIgcGFyc2VTdHJpbmcgPSByZXF1aXJlKCd4bWwyanMnKS5wYXJzZVN0cmluZztcblxubW9kdWxlLmV4cG9ydHMuZ2V0X2NsaWVudF9jb3VudCA9IGZ1bmN0aW9uKHN0cmVhbU5hbWUsIGZ1bmMpIHtcbiAgICBkaWdlc3RSZXF1ZXN0LnJlcXVlc3Qoe1xuICAgICAgICBob3N0OiAnaHR0cDovLzExNC41NS4xNDcuNzAnLFxuICAgICAgICBwYXRoOiAnL2Nvbm5lY3Rpb25jb3VudHM/ZmxhdCcsXG4gICAgICAgIHBvcnQ6IDgwODYsXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgfSwgZnVuY3Rpb24gKGVycm9yLCByZXNwb25zZSwgYm9keSkge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIGZ1bmMoJzAnKTtcbiAgICAgICAgICAgIC8vdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvL2NvbnNvbGUubG9nKGJvZHkpO1xuICAgICAgICBwYXJzZVN0cmluZyhib2R5LCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcbiAgICAgICAgICAgIC8vY29uc29sZS5kaXIocmVzdWx0KTtcbiAgICAgICAgICAgIHZhciBzdHJlYW1zID0gcmVzdWx0WydXb3d6YVN0cmVhbWluZ0VuZ2luZSddWydTdHJlYW0nXTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ3N0cmVhbXMgPSAnICsgc3RyZWFtcyk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0cmVhbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHN0cmVhbXNbaV0pO1xuICAgICAgICAgICAgICAgIHZhciBzdHJlYW0gPSBzdHJlYW1zW2ldWyckJ107XG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBzdHJlYW1bJ3N0cmVhbU5hbWUnXTtcbiAgICAgICAgICAgICAgICB2YXIgc2Vzc2lvbnNUb3RhbCA9IHN0cmVhbVsnc2Vzc2lvbnNUb3RhbCddO1xuXG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgPT0gc3RyZWFtTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZnVuYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnVuYyhzZXNzaW9uc1RvdGFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuYygnMCcpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0iXX0=
